<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-06-23 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170623" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HAPI &#x2013; What's New</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://hapifhir.github.io/hapi-hl7v2" id="bannerLeft"><img src="images/hapi_banner.png"  alt="HAPI"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-06-23<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.3</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://www.uhn.ca/" class="externalLink" title="University Health Network">University Health Network</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://hl7.org/" class="externalLink" title="hl7.org">hl7.org</a></li>
      <li class="pull-right"><a href="https://github.com/hapifhir/hapi-hl7v2" class="externalLink" title="GitHub Project Page">GitHub Project Page</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Welcome</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
    <li><a href="changes-report.html" title="Changelog"><span class="none"></span>Changelog</a>  </li>
    <li><a href="https://smilecdr.com/blog/" class="externalLink" title="Blog"><span class="none"></span>Blog</a>  </li>
          <li class="nav-header">FHIR</li>
    <li><a href="hapi-fhir/" title="HAPI FHIR"><span class="none"></span>HAPI FHIR</a>  </li>
          <li class="nav-header">Tools</li>
    <li><a href="hapi-testpanel/index.html" title="TestPanel"><span class="none"></span>TestPanel</a>  </li>
    <li><a href="hapi-hl7overhttp/index.html" title="HL7 over HTTP"><span class="none"></span>HL7 over HTTP</a>  </li>
    <li><a href="colouriser.html" title="Colouriser"><span class="none"></span>Colouriser</a>  </li>
          <li class="nav-header">Download</li>
    <li><a href="https://sourceforge.net/projects/hl7api/files/hl7api/" class="externalLink" title="Download Java API"><span class="none"></span>Download Java API</a>  </li>
    <li><a href="hapi-testpanel/install.html" title="Download TestPanel"><span class="none"></span>Download TestPanel</a>  </li>
          <li class="nav-header">Documentation</li>
    <li><a href="getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="devbyexample.html" title="HAPI By Example"><span class="none"></span>HAPI By Example</a>  </li>
    <li><a href="base/apidocs/index.html" title="JavaDoc (API core)"><span class="icon-chevron-down"></span>JavaDoc (API core)</a>
      <ul class="nav nav-list">
    <li><a href="v21/apidocs/index.html" title="v2.1 Messages"><span class="none"></span>v2.1 Messages</a>  </li>
    <li><a href="v22/apidocs/index.html" title="v2.2 Messages"><span class="none"></span>v2.2 Messages</a>  </li>
    <li><a href="v23/apidocs/index.html" title="v2.3 Messages"><span class="none"></span>v2.3 Messages</a>  </li>
    <li><a href="v231/apidocs/index.html" title="v2.3.1 Messages"><span class="none"></span>v2.3.1 Messages</a>  </li>
    <li><a href="v24/apidocs/index.html" title="v2.4 Messages"><span class="none"></span>v2.4 Messages</a>  </li>
    <li><a href="v25/apidocs/index.html" title="v2.5 Messages"><span class="none"></span>v2.5 Messages</a>  </li>
    <li><a href="v251/apidocs/index.html" title="v2.5.1 Messages"><span class="none"></span>v2.5.1 Messages</a>  </li>
    <li><a href="v26/apidocs/index.html" title="v2.6 Messages"><span class="none"></span>v2.6 Messages</a>  </li>
    <li><a href="v27/apidocs/index.html" title="v2.7 Messages"><span class="none"></span>v2.7 Messages</a>  </li>
    <li><a href="v28/apidocs/index.html" title="v2.8 Messages"><span class="none"></span>v2.8 Messages</a>  </li>
    <li><a href="v281/apidocs/index.html" title="v2.8.1 Messages"><span class="none"></span>v2.8.1 Messages</a>  </li>
      </ul>
  </li>
    <li><a href="xref/index.html" title="Source XRef"><span class="none"></span>Source XRef</a>  </li>
    <li><a href="hapi-faq.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
    <li><a href="conformance.html" title="Conformance Tools"><span class="none"></span>Conformance Tools</a>  </li>
    <li><a href="hapi-sourcegen/confgen-usage.html" title="Maven Plugins"><span class="none"></span>Maven Plugins</a>  </li>
          <li class="nav-header">Get Help</li>
    <li><a href="mail-lists.html" title="Mailing List"><span class="none"></span>Mailing List</a>  </li>
          <li class="nav-header">Contribute</li>
    <li><a href="building.html" title="Hacking HAPI"><span class="none"></span>Hacking HAPI</a>  </li>
    <li><a href="submissions.html" title="Submitting Code"><span class="none"></span>Submitting Code</a>  </li>
    <li><a href="issue-tracking.html" title="Issue Tracking"><span class="none"></span>Issue Tracking</a>  </li>
    <li><a href="source-repository.html" title="Source Code"><span class="none"></span>Source Code</a>  </li>
          <li class="nav-header">Reports</li>
    <li><a href="team-list.html" title="HAPI Developers"><span class="none"></span>HAPI Developers</a>  </li>
    <li><a href="surefire-report.html" title="Unit Test Report"><span class="none"></span>Unit Test Report</a>  </li>
    <li><a href="taglist.html" title="Source Tag List"><span class="none"></span>Source Tag List</a>  </li>
    <li><a href="cobertura/index.html" title="Cobertura"><span class="none"></span>Cobertura</a>  </li>
    <li><a href="findbugs.html" title="FindBugs"><span class="none"></span>FindBugs</a>  </li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a>  </li>
          <li class="nav-header">Older Documentation</li>
    <li><a href="parsing.html" title="Parsing Messages"><span class="none"></span>Parsing Messages</a>  </li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a>  </li>
    <li><a href="links.html" title="Helpful Links"><span class="none"></span>Helpful Links</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org" title="Built with Maven 2" class="builtBy"><img class="builtBy"  alt="Built with Maven 2" src="images/logos/maven-feather.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Whats_New"></a>What's New</h2>
<p>This page shows new features in HAPI.</p></div>
<div class="section">
<h2><a name="Version_1.1"></a>Version 1.1</h2>
<p>Version 1.1 is API compatible with version 1.0 (aside from a method change in the Message interface, but this should not generally be directly extended). Upgrading should be as simple as dropping in the updated JARs. This release includes several important bugfixes and a number of great contributions. See the <a href="./changes-report.html">Changelog</a> for more information.</p>
<div class="section">
<h3><a name="Noteworthy_new_features"></a>Noteworthy new features</h3>
<div class="section">
<h4><a name="Structure_Class_Generator_Maven_Plugin"></a>Structure Class Generator Maven Plugin</h4>
<p>HAPI now includes a Maven Plugin which can be used to translate an HL7 Conformance Profile into a set of HAPI structure objects representing Message/Group/Segment types. See the <a class="externalLink" href="http://hl7api.sourceforge.net/conformance.html">conformance</a> page for more information. </p></div>
<div class="section">
<h4><a name="QuickStart_method_to_initialize_Messages"></a>QuickStart method to initialize Messages</h4>
<p>AbstractMessage provides an &quot;initQuickstart&quot; method for quickly setting values in the MSH segment to standard default values:</p>
<div class="source"><pre class="prettyprint">        public static void main(String[] args) throws HL7Exception, IOException {
                ORU_R01 msg = new ORU_R01();
                msg.initQuickstart(&quot;ORU&quot;, &quot;R01&quot;, &quot;T&quot;);
                System.out.println(msg);
                // MSH|^~\&amp;|||||20110220174633.569-0500||ORU^R01^ORU_R01|436|T|2.4
        }</pre></div></div>
<div class="section">
<h4><a name="Convenience_methods_for_temportal_datatypes"></a>Convenience methods for temportal datatypes</h4>
<p>HAPI now has some pleasant convenience methods for bridging the gap between HL7's Date/Time types and Java Date/Calendar types:</p>
<div class="source"><pre class="prettyprint">                ORU_R01 msg = new ORU_R01();
                msg.initQuickstart(&quot;ORU&quot;, &quot;R01&quot;, &quot;T&quot;);
                
                TS ts = msg.getPATIENT_RESULT().getORDER_OBSERVATION().getORC().getDateTimeOfTransaction();
                DTM time = ts.getTime();
                time.setValue(&quot;20110201121233&quot;);
                
                Date date = time.getValueAsDate();
                System.out.println(date);
                // Tue Feb 01 12:12:33 EST 2011

                Calendar cal = new GregorianCalendar();
                cal.set(Calendar.YEAR, 2010);
                cal.set(Calendar.MONTH, 0);
                cal.set(Calendar.DATE, 29);
                cal.set(Calendar.HOUR_OF_DAY, 12);
                cal.set(Calendar.MINUTE, 59);
                time.setValueToMinute(cal);
                
                System.out.println(ts.encode());
                // 201001291259

                cal = time.getValueAsCalendar();
                System.out.println(cal.getTime());
                // Tue Feb 01 12:12:33 EST 2011</pre></div></div>
<div class="section">
<h4><a name="Application_Exception_Handlers"></a>Application Exception Handlers</h4>
<p>Application instances may now declare an <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/app/ApplicationExceptionHandler.html">additional interface</a> which allows them to process exceptions and optionally override the system generated response message. (Thanks to Gabriel Landais) </p>
<div class="source"><pre class="prettyprint">    /**
         * Example Application processor which always attempts to generate an
         * ACK, even if exceptions are thrown
         */
        private class MyApplication implements Application, ApplicationExceptionHandler {

                public String processException(String incomingMessage, String outgoingMessage, Exception e) throws HL7Exception {

                        // Process/log the exception..?

                        ADT_A01 message = new ADT_A01();
                        try {
                                message.parse(incomingMessage);
                        } catch (HL7Exception e2) {
                                // ignore
                        }
                        
                        // create a new ACK message
                        ACK ack = new ACK();
                        try {
                                ack.initQuickstart(&quot;ACK&quot;, null, null);
                        } catch (IOException e1) {
                                throw new HL7Exception(e1);
                        }

                        ack.getMSA().getMsa1_AcknowledgmentCode().setValue(&quot;AA&quot;);
                        ack.getMSA().getMsa2_MessageControlID().setValue(message.getMSH().getMessageControlID().getValue());
                        
                        return ack.encode();
                }

                public Message processMessage(Message in) throws ApplicationException, HL7Exception {
                        
                        // do some processing
                        
                        try {
                                return in.generateACK();
                        } catch (IOException e) {
                                throw new HL7Exception(e);
                        }
                }

                public boolean canProcess(Message in) {
                        return true;
                }
                
        }</pre></div></div></div></div>
<div class="section">
<h2><a name="Version_1.0"></a>Version 1.0</h2>
<p>Version 1.0 contains a number of bugfixes. See the <a href="#changes-report.html">Changelog</a> for more information.</p>
<div class="section">
<h3><a name="Noteworthy_new_features"></a>Noteworthy new features</h3>
<div class="section">
<h4><a name="Parser_Speed_Improvements"></a>Parser Speed Improvements</h4>
<p>For version 1.0, a major effort to profile and speed up the parser was made (with some help from Christian Ohr). This resulted in a fairly significant improvement. The figure above shows a comparison between performing parses and encodes on versions 0.6 and 1.0. The simple message used is a very simple ADT^A01 with minimal data. The complex message used is a fairly long ORU^R01 with 50 segments. Times are in millis (shorter is better).</p><img src="images/speed_comparison_1_0.png" alt="Speed Comparison" />
<p>(Tests performed 1000 iterations of a parse or an encode on an Athlon64 X2 2.2Ghz CPU with 6Gb of RAM)</p></div>
<div class="section">
<h4><a name="Convenience_Parse_and_Encode_Methods"></a>Convenience Parse and Encode Methods</h4>
<p>HAPI structures now have a few new convenience methods to parse and encode various structures. For example, messages may have values parsed in through the parse(String) method, and messages may be re-encoded using the encode() method.</p>
<div class="source"><pre class="prettyprint">String string = &quot;MSH|^~\\&amp;|LABGL1||DMCRES||19951002185200||ADT^A01|LABGL1199510021852632|P|2.2\r&quot;
              + &quot;PID|||T12345||TEST^PATIENT^P||19601002|M||||||||||123456\r&quot;
              + &quot;PV1|||NER|||||||GSU||||||||E||||||||||||||||||||||||||19951002174900|19951006\r&quot;;

ADT_A01 a01 = new ADT_A01();
a01.parse(string); // Parses the text into the message object using PipeParser (by default, can be changed)

System.out.println(a01.encode()); // Re-encodes the message using the default parser</pre></div>
<p>Segments and fields also have parse() and encode() methods</p>
<div class="source"><pre class="prettyprint">String pid = a01.getPID().encode();
System.out.println(pid); // PID|||T12345||TEST^PATIENT^P||19601002|M||||||||||123456

String messageType = a01.getMSH().getMessageType().encode();
System.out.println(messageType); // ADT^A01

// Set the message type the old way
a01.getMSH().getMessageType().getMessageType().setValue(&quot;ADT&quot;);
a01.getMSH().getMessageType().getTriggerEvent().setValue(&quot;A04&quot;);

// A quicker way of doing it
a01.getMSH().getMessageType().parse(&quot;ADT^A04&quot;);</pre></div></div>
<div class="section">
<h4><a name="Convenience_Numbered_Segment_Getters"></a>Convenience Numbered Segment Getters</h4>
<p>Segments now have a second set of accessors with numbers in them, so that if you want (for instance) to jump straight to PID-3 using your IDE's autocomplete without remembering the name of the field, you can do that.</p>
<div class="source"><pre class="prettyprint">// The old way
a01.getPID().getPatientIDInternalID(0).parse(&quot;1234&quot;);

// The alternate way
a01.getPID().getPid3_PatientIDInternalID(0).parse(&quot;1234&quot;);</pre></div></div>
<div class="section">
<h4><a name="Convenience_ACKNAK_generators"></a>Convenience ACK/NAK generators</h4>
<p>This is a great idea from the Open eHealth <a class="externalLink" href="http://repo.openehealth.org/confluence/display/ipf/HAPI+extensions">HAPI extensions</a> project.</p>
<p>The message class can now generate a corresponding ACK or NAK based on the contents of the message's own contents.</p>
<div class="source"><pre class="prettyprint">// Parse the message
String string = &quot;MSH|^~\\&amp;|LABGL1||DMCRES||19951002185200||ADT^A01|LABGL1199510021852632|P|2.2\r&quot;
                + &quot;PID|||T12345||TEST^PATIENT^P||19601002|M||||||||||123456\r&quot;
                + &quot;PV1|||NER|||||||GSU||||||||E||||||||||||||||||||||||||19951002174900|19951006\r&quot;;
Message message = new PipeParser().parse(string);

// Generate an ACK
Message ack = message.generateACK();
System.out.println(ack.encode());
// MSH|^~\&amp;|||||20090926173004.067-0500||ACK|225|P|2.2
// MSA|AA|LABGL1199510021852632

// Generate a NAK
Message nak = message.generateACK(&quot;AR&quot;, new HL7Exception(&quot;Error Message&quot;, HL7Exception.ACK_AE));
System.out.println(nak.encode());
// MSH|^~\&amp;|||||20090926180218.494-0500||ACK|231|P|2.2
// MSA|AR|LABGL1199510021852632
// ERR|^^^2&amp;ERROR&amp;hl70357&amp;&amp;Error Message</pre></div></div>
<div class="section">
<h4><a name="Better_handling_of_unexpected_segments_in_PipeParser"></a>Better handling of unexpected segments in PipeParser</h4>
<p>Thanks to an overhaul of the PipeParser's inner workings, it can now handle unexpected segments (such as custom Z-segments in standard messages) in a much more predictable way, reducing the need for custom classes much of the time.</p>
<p>Consider the following code sample (note the custom 4th segment- ZPI):</p>
<div class="source"><pre class="prettyprint">                String messageText =
                  &quot;MSH|^~\\&amp;|IRIS|SANTER|AMB_R|SANTER|200803051508||ADT^A01|263206|P|2.5\r&quot;
                                + &quot;EVN||200803051509||||200803031508\r&quot;
                                + &quot;PID|||5520255^^^PK^PK~ZZZZZZ83M64Z148R^^^CF^CF~ZZZZZZ83M64Z148R^^^SSN^SSN^^20070103^99991231~^^^^TEAM||ZZZ^ZZZ||19830824|F||||||||||||||||||||||N\r&quot;
                                + &quot;ZPI|Fido~Fred|13\r&quot;
                                + &quot;PV1||I|6402DH^^^^^^^^MED. 1 - ONCOLOGIA^^OSPEDALE MAGGIORE DI LODI&amp;LODI|||^^^^^^^^^^OSPEDALE MAGGIORE DI LODI&amp;LODI|13936^TEST^TEST||||||||||5068^TEST2^TEST2||2008003369||||||||||||||||||||||||||200803031508\r&quot;
                                + &quot;PR1|1||1111^Mastoplastica|Protesi|20090224|02|&quot;;

        // HAPI will still parse this message fine
        ADT_A03 message = (ADT_A03) new PipeParser().parse(messageText);</pre></div>
<p>Previously, upon hitting the unexpected ZPI segment, the parser would recurse as deep as it could into the first group it found, and would drop the unexpected segment at the tail of that, leaving you with segments in completely unexpected places.</p>
<p>The new behaviour is that upon finding a segment that isn't supposed to be found anywhere in the message, a custom segment is inserted into the current location, and parsing continues normally.</p>
<p>Note that if you have code depending on the old behaviour, PipeParser has a setLegacyMode and corresponding system property that can be set (see the javadoc)</p></div>
<div class="section">
<h4><a name="Insert_and_delete_segment_repetitions"></a>Insert and delete segment repetitions</h4>
<p>It is now possible to insert and delete repetitions of segments and segment groups at arbitrary positions within their parent group.</p>
<div class="source"><pre class="prettyprint">    // Insert a new observation group (OBX-NTE) segment between reps 1 and 2
    ORU_R01_OBSERVATION newGroup = oruR01.getPATIENT_RESULT().getORDER_OBSERVATION().insertOBSERVATION(1);
    newGroup.getOBX().getSetIDOBX().setValue(&quot;2&quot;);

    // Delete the observation group (OBX-NTE) segment between reps 1 and 2
    ORU_R01_OBSERVATION obx = oruR01.getPATIENT_RESULT().getORDER_OBSERVATION().removeOBSERVATION(1);</pre></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2001&#x2013;2017
<a href="http://www.uhn.ca">University Health Network</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    <script type="text/javascript">
                var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
                document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
                </script>
                <script type="text/javascript">
                try {
                var pageTracker = _gat._getTracker("UA-1395874-1");
                pageTracker._trackPageview();
                } catch(err) {}</script>
                </body >
</html>
